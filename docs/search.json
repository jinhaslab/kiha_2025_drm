[
  {
    "objectID": "Dose_Response_Model_III.html",
    "href": "Dose_Response_Model_III.html",
    "title": "4  비선형 모델 비교과 MixedModel",
    "section": "",
    "text": "4.1 여러 비선형 모델 비교 및 선택\n이 챕터에서는 앞서 배운 기본적인 고퍼츠(Gompertz) 모델을 넘어, 실제 연구에서 마주하는 복잡한 상황을 다루는 방법을 알아봅니다. 특히, 여러 비선형 모델을 비교하고, 교대 근무와 같은 중요한 공변량이 용량-반응 관계에 미치는 영향을 어떻게 분석하는지 배울 것입니다.\n용량-반응 관계는 언제나 S자형 곡선(Gompertz, Logistic)만 따르는 것은 아닙니다. 때로는 힐(Hill) 모델과 같이 민감도가 다른 곡선이 더 적합할 수 있습니다. 우리가 가진 데이터에 어떤 모델이 가장 잘 맞는지 평가하는 것은 매우 중요합니다.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>비선형 모델 비교과 MixedModel</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model_III.html#여러-비선형-모델-비교-및-선택",
    "href": "Dose_Response_Model_III.html#여러-비선형-모델-비교-및-선택",
    "title": "4  비선형 모델 비교과 MixedModel",
    "section": "",
    "text": "4.1.1 모델 이론\n\n로지스틱 모델: y(dose)=fraca1+exp(−b(dose−c))\n\nS자형 곡선을 설명하는 가장 기본적인 모델입니다. 특히, 질병 발생 여부와 같은 이항형 결과를 다룰 때 많이 사용됩니다\na: 최대 반응값\nb: 곡선의 기울기(성장률)\nc: LD50(반응이 50%가 되는 용량)\n\n힐 모델: \\[y = \\text{Bottom} + \\frac{(\\text{Top} - \\text{Bottom}) \\cdot \\text{dose}^n}{\\text{EC}_{50}^n + \\text{dose}^n}\\]\n\n$ n $: 힐 계수 (설명의 b, 곡선 기울기/민감도).\n$ _{50} $: 반응이 50%가 되는 용량 (설명의 c, LD50).\n$ , $: 최소/최대 반응값 (설명에서 암묵적으로 포함).\n\n\n\n\n4.1.2 실습: 모델 피팅 및 비교\n세 가지 모델(Gompertz, Logistic, Hill)을 모두 데이터에 피팅하고, 통계적인 지표인 AIC(Akaike Information Criterion) 값을 비교하여 어떤 모델이 가장 적합한지 평가해 봅시다. AIC는 모델의 복잡성과 데이터에 대한 적합도를 동시에 고려하여, AIC 값이 가장 낮은 모델이 가장 좋은 모델입니다.\n\n# Gompertz 모델 함수\ngompertz &lt;- function(dose, a, mu, lambda) {\n  a * exp(-exp(mu * exp(1) / a * (lambda - dose) + 1))\n}\n\n# 로지스틱 모델 함수\nlogistic &lt;- function(dose, a, b, c) {\n  a / (1 + exp(-b * (dose - c)))\n}\n\n# 힐 모델 함수\nhill &lt;- function(dose, a, b, c) {\n  (a * dose^b) / (c^b + dose^b)\n}\n\n# LD50 계산 함수\nld50_logistic &lt;- function(model) {\n  coefs &lt;- coef(model)\n  ld50 &lt;- coefs[\"c\"]\n  return(ld50)\n}\n\n# 데이터 생성\nset.seed(0)\ndose &lt;- seq(0, 10, 0.1)\npb &lt;- c(rnorm(50, 0, 0.001), rnorm(30, 0, 0.01), rnorm(10, 0.1, 0.05), rnorm(11, -0.1, 0.05))\nresp &lt;- 1 / (1 + exp(-(dose - 5))) + rnorm(length(dose), 0, 0.1) + pb\ncohort &lt;- tibble(dose, resp)\n\n# 여러 모델 피팅\nnls_gompertz &lt;- nls_multstart(\n  resp ~ gompertz(dose, a, mu, lambda),\n  data = cohort,\n  start_lower = c(a = 0, mu = 0, lambda = 0),\n  start_upper = c(a = 2, mu = 1, lambda = 10),\n  iter = 250 # iter 인자 추가\n)\n\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\n\nnls_logistic &lt;- nls_multstart(\n  resp ~ logistic(dose, a, b, c),\n  data = cohort,\n  start_lower = c(a = 0, b = 0, c = 0),\n  start_upper = c(a = 2, b = 1, c = 10),\n  iter = 250 # iter 인자 추가\n)\n\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\nError in nlsModel(formula, mf, start, wts) : \n  singular gradient matrix at initial parameter estimates\n\nnls_hill &lt;- nls_multstart(\n  resp ~ hill(dose, a, b, c),\n  data = cohort,\n  start_lower = c(a = 0, b = 0, c = 0),\n  start_upper = c(a = 2, b = 10, c = 10),\n  iter = 250 # iter 인자 추가\n)\n\n\n# AIC 값 비교\naic_values &lt;- AIC(nls_gompertz, nls_logistic, nls_hill)\nprint(aic_values)\n\n             df       AIC\nnls_gompertz  4 -153.2274\nnls_logistic  4 -160.6434\nnls_hill      4 -156.0963\n\n\n제공된 코드의 AIC 비교 결과를 보면 다음과 같습니다.\n\n\n\n모델\nAIC 값\n\n\nnls_gompertz\n-153.2274\n\n\nnls_logistic\n-160.6434\n\n\nnls_hill\n-156.0963\n\n\n\n이 결과를 보면\nLogistic 모델의 AIC가 -160.6434로 가장 낮습니다. 이는 우리가 생성한 데이터에 대해 로지스틱 모델이 다른 두 모델보다 통계적으로 더 우수한 적합도를 보인다는 것을 의미합니다.\n이 결과를 그래프로 시각화해 보면, 세 개의 곡선이 데이터에 어떻게 피팅되는지 한눈에 확인할 수 있습니다.\n\n# 모든 모델을 한 그래프에 시각화\ncohort_predicted &lt;- cohort %&gt;%\n  mutate(\n    Gompertz = predict(nls_gompertz),\n    Logistic = predict(nls_logistic),\n    Hill = predict(nls_hill)\n  ) %&gt;%\n  pivot_longer(\n    cols = c(Gompertz, Logistic, Hill),\n    names_to = \"Model\",\n    values_to = \"Predicted_Response\"\n  )\n\nggplot(cohort, aes(x = dose, y = resp)) +\n  geom_point(alpha = 0.5) +\n  geom_line(data = cohort_predicted, aes(y = Predicted_Response, color = Model), size = 1.2) +\n  labs(\n    title = \"다양한 비선형 모델 비교\",\n    x = \"용량 (Dose)\",\n    y = \"반응 (Response)\",\n    color = \"모델\"\n  ) +\n  theme_minimal()",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>비선형 모델 비교과 MixedModel</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model_III.html#실제-데이터의-변수-고려-공변량covariates-분석",
    "href": "Dose_Response_Model_III.html#실제-데이터의-변수-고려-공변량covariates-분석",
    "title": "4  비선형 모델 비교과 MixedModel",
    "section": "4.2 실제 데이터의 변수 고려: 공변량(Covariates) 분석",
    "text": "4.2 실제 데이터의 변수 고려: 공변량(Covariates) 분석\n이제 한 걸음 더 나아가, 교대 근무와 같은 공변량이 용량-반응 관계에 어떤 영향을 미치는지 분석해 봅시다. 실제 직업 환경에서는 개인의 근무 형태나 생활 습관 등이 유해물질 노출에 대한 질병 반응에 영향을 줄 수 있습니다. 우리는 교대 근무 여부에 따라 과로와 질병 반응 간의 관계가 달라지는 상황을 시뮬레이션했습니다.\n\n4.2.1 시뮬레이션: 공변량 효과\n우리는 두 그룹의 가상 데이터를 만들었습니다.\n\n비교대 근무자: 과로가 증가할수록 질병 반응이 선형적으로 증가하는 그룹입니다.\n교대 근무자: 과로가 증가할수록 질병 반응이 고퍼츠 곡선을 따라 증가하는 그룹입니다. 즉, 특정 시점부터 질병 반응이 급격하게 증가하는 패턴을 보입니다.\n\n혼합 효과 모델은 이 두 그룹의 관계를 하나의 통합된 모델로 분석하는 도구입니다.\n\n# nlme 패키지 로드\nlibrary(nlme)\nlibrary(tidyverse)\n\n# Gompertz 모델 함수\ngompertz &lt;- function(dose, a, mu, lambda) {\n  a / (1 + exp(-mu * (dose - lambda)))\n}\n\n# 데이터 생성\nset.seed(123)\ndose &lt;- seq(0, 10, 0.1)\nn_dose &lt;- length(dose)\n\n# 비 교대 근무자 그룹의 반응 (느린 Gompertz 곡선)\nresp_nonshift &lt;- gompertz(dose, a = 1.2, mu = 0.5, lambda = 5) + rnorm(n_dose, 0, 0.05)\n\n# 교대 근무자 그룹의 반응 (더 가파른 Gompertz 곡선)\nresp_shift &lt;- gompertz(dose, a = 1.2, mu = 0.8, lambda = 5) + rnorm(n_dose, 0, 0.05)\n\n# 두 그룹의 데이터를 하나의 데이터프레임으로 결합\ncohort_full &lt;- tibble(\n  dose = rep(dose, 2),\n  shift = factor(c(rep(\"비교대\", n_dose), rep(\"교대\", n_dose))),\n  resp = c(resp_nonshift, resp_shift)\n)\n# 데이터 시각화\nggplot(cohort_full, aes(x = dose, y = resp, color = shift)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"gam\", formula = y ~ s(x), se = FALSE) +\n  labs(\n    title = \"교대 근무 여부에 따른 용량-반응 관계 (시뮬레이션 탐색)\",\n    x = \"과로 (Dose)\",\n    y = \"질병 반응 (Response)\",\n    color = \"교대근무 여부\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(plot.title = element_text(face = \"bold\"))\n\n\n\n\n\n\n\n\n\n# 혼합 효과 모델 피팅\n# 두 그룹 모두 Gompertz 곡선을 따르는 가정을 반영합니다.\n# fixed = a + mu + lam ~ shift는 shift 그룹에 따라 파라미터 a, mu, lam이 달라지도록 설정합니다.\nnlme_fit &lt;- nlme(\n  model = resp ~ a / (1 + exp(-(mu * (dose - lam)))),\n  data = cohort_full,\n  fixed = a + mu + lam ~ shift, \n  random = a + mu + lam ~ 1 | shift,\n  start = c(a = c(1.2, 1.2), mu = c(0.5, 0.8), lam = c(5, 5)), \n  control = list(pnlsTol = 0.01)\n)\n# 모델 결과 요약\n#summary(nlme_fit)\n\n# 모델 예측값 계산\ncohort_full$nlme_pred &lt;- predict(nlme_fit)\n\n# 혼합 효과 모델 시각화\nggplot(cohort_full, aes(x = dose, y = resp, color = shift)) +\n  geom_point(alpha = 0.5) +\n  geom_line(aes(y = nlme_pred, group = shift), size = 1.2) +\n  labs(\n    title = \"혼합 효과 모델 결과 (그룹별 파라미터)\",\n    x = \"용량 (Dose)\",\n    y = \"질병 반응 (Response)\",\n    color = \"교대근무 여부\"\n  ) +\n  theme_minimal(base_size = 14)\n\n\n\n\n\n\n\n\n\nsummary(nlme_fit)\n\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: resp ~ a/(1 + exp(-(mu * (dose - lam)))) \n  Data: cohort_full \n        AIC       BIC   logLik\n  -634.3112 -591.3037 330.1556\n\nRandom effects:\n Formula: list(a ~ 1, mu ~ 1, lam ~ 1)\n Level: shift\n Structure: General positive-definite, Log-Cholesky parametrization\n                StdDev       Corr         \na.(Intercept)   9.047340e-07 a.(In) m.(In)\nmu.(Intercept)  1.149202e-06 0            \nlam.(Intercept) 1.844210e-06 0      0     \nResidual        4.719949e-02              \n\nFixed effects:  a + mu + lam ~ shift \n                    Value  Std.Error  DF  t-value p-value\na.(Intercept)    1.195727 0.01404366 195 85.14359  0.0000\na.shift비교대    0.029480 0.03142533 195  0.93811  0.3493\nmu.(Intercept)   0.835771 0.02898145 195 28.83812  0.0000\nmu.shift비교대  -0.345475 0.03510659 195 -9.84075  0.0000\nlam.(Intercept)  5.000389 0.05323858 195 93.92415  0.0000\nlam.shift비교대  0.082515 0.14068227 195  0.58653  0.5582\n Correlation: \n                a.(In) ashft대 m.(In) mshft대 lm.(I)\na.shift비교대   -0.447                              \nmu.(Intercept)  -0.685  0.306                       \nmu.shift비교대   0.565 -0.680  -0.826               \nlam.(Intercept)  0.770 -0.344  -0.527  0.435        \nlam.shift비교대 -0.291  0.910   0.200 -0.581  -0.378\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-2.53316379 -0.67449163 -0.07048116  0.62151401  3.28479392 \n\nNumber of Observations: 202\nNumber of Groups: 2 \n\n# p-value 계산 및 출력 (tidy형식)\n# fixed effects 결과를 추출합니다.\n#fixed_effects &lt;- summary(nlme_fit)$tTable\n# p-value를 계산합니다. (t-value와 자유도(DF)를 이용)\n#p_values &lt;- 2 * (1 - pt(abs(fixed_effects[, \"t-value\"]), fixed_effects[, \"DF\"]))\n# 계산된 p-value를 기존 summary 출력에 추가하여 보여줍니다.\n#fixed_effects_with_p &lt;- cbind(fixed_effects, `p-value` = p_values)\n#print(fixed_effects_with_p)\n\n혼합 효과 모델은 단순히 두 곡선을 그리는 것을 넘어, 두 그룹이 통계적으로 어떻게 다른지를 알려줍니다. summary(nlme_fit) 결과를 자세히 해석해 보겠습니다.\n\n\n\n\n\n\n\n\n\n\n효과\n파라미터\n값 (Value)\np-value\n의미\n\n\n고정 효과\na.(Intercept)\n1.195727\n0.0000\n비교대 근무자의 최대 반응값(a)입니다.\n\n\n\na.shift비교대\n0.029480\n0.3493\n비교대 근무자를 기준으로 교대 근무자의 a 값이 얼마나 다른지를 나타냅니다. p-value가 0.05보다 커서 통계적으로 유의미한 차이가 없습니다.\n\n\n\nmu.(Intercept)\n0.835771\n0.0000\n교대 근무자의 기울기(mu)입니다.\n\n\n\nmu.shift비교대\n-0.345475\n0.0000\n교대 근무자를 기준으로 비교대 근무자의 mu 값이 얼마나 다른지를 나타냅니다. p-value가 0.0001로 매우 작아서, 두 그룹의 기울기에는 통계적으로 매우 유의미한 차이가 있습니다.\n\n\n\nlam.(Intercept)\n5.000389\n0.0000\n교대 근무자의 시작점(lam)입니다.\n\n\n\nlam.shift비교대\n0.082515\n0.5582\n교대 근무자를 기준으로 비교대 근무자의 lam 값이 얼마나 다른지를 나타냅니다. 통계적으로 유의미한 차이는 없습니다.\n\n\n\n이 결과를 통해 우리는 ‘과로에 대한 질병 반응의 기울기(mu)는 교대 근무자와 비교대 근무자 간에 통계적으로 유의미하게 다르다’는 결론을 내릴 수 있습니다. 이는\n교대 근무 여부라는 공변량이 용량-반응 관계에 중요한 영향을 미친다는 강력한 증거가 됩니다.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>비선형 모델 비교과 MixedModel</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html",
    "href": "Dose_Response_Model.html",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "",
    "text": "2.1 Exposure (Dose) and Health\nif(!require(tidyverse)) install.packages(\"tidyverse\")\nif(!require(ggplot2)) install.packages(\"ggplot2\")\nif(!require(knitr)) install.packages(\"knitr\")\nif(!require(kableExtra)) install.packages(\"kableExtra\")\n우리몸에 필수 요소가 있다고 상상해 봅시다. 예를 들어 적혈구 백혈구를 생각해 보는 것입니다. 적혈구가 너무 적으면 빈혈과 같은 질병이 있는 것이고, 너무 많으면 적혈구 과다증이 있어 건강에 해롭습니다.  어떤 필수 요소가 너무 적거나 많은 상태를 질병으로, 적절한 양이 있는 경우 건강상태로 보는 것입니다. 다음과 같은 상황을 상상해 보겠습니다.\ntrace.e &lt;- seq(1,50, by=0.1)\n#normal range = 15~35\ntrace.e.h=function (x) {\n  ifelse(x&lt;20, 1/(1+exp(-x+10)),\n         ifelse(x&lt;30, rnorm(1, 1/(1+exp(-19)), 0.01), \n                1/(1+exp(-19))-1/(1+exp(40-x))\n                )\n        )\n  }\nhstatus&lt;-trace.e.h(trace.e)+rnorm(length(trace.e), 1, 0.1)\nbasic = tibble(trace.e, hstatus)\n이러한 관계를 그림으로 그려 보겠습니다. 기능적 측면에서 생물학적 필수 요소가 너무 적거나 너무 많으면 사망하거나 질병이 있는 상태로, 절적 수준이 유지되는 것을 정상상태로 볼 수 있습니다.\nbasic %&gt;%\n  ggplot(aes(x= trace.e, y = hstatus)) +\n  scale_x_continuous(name=\"Biological Element\") +\n  scale_y_continuous(name=\"Function\") +\n  theme_minimal()+\n  geom_rect(data=basic[1,],aes(xmin=-Inf, xmax=7 , ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.8) +\n  geom_rect(data=basic[1,],aes(xmin=7,    xmax=15, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.5) +\n  geom_rect(data=basic[1,],aes(xmin=15,   xmax=35, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.3) +\n  geom_rect(data=basic[1,],aes(xmin=35,   xmax=43, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.5) +\n  geom_rect(data=basic[1,],aes(xmin=43,   xmax=52, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.8) +\n  geom_point(size=1, color = 'grey50') +\n  annotate(geom=\"text\", x=c(3,47),  y=c(1.3, 1.3), label=\"Death\",    color=\"red\") +\n  annotate(geom=\"text\", x=c(10,38), y=c(1.5, 1.5), label=\"Disease\",  color=\"black\") +\n  annotate(geom=\"text\", x=25,       y=1.7,         label=\"Normal Function\",color=\"blue\")\n위의 그림을 Y축을 적혈구의 기능 측면에서 본 것으로 상상해보면 이해가 갑니다. 다음에는 적혈구의 가능을 악화시키는 물질에 노출되었다고 상상하고 기능이 아닌 질병 측면에서 볼 수 있습니다. 거꾸로 그래프를 뒤집을 수 있습니다.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#exposure-dose-and-health",
    "href": "Dose_Response_Model.html#exposure-dose-and-health",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "",
    "text": "자료 생성\n\n\n\n그림 그리기",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#실습-1-질병-그림-그리기",
    "href": "Dose_Response_Model.html#실습-1-질병-그림-그리기",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.2 실습 1: 질병 그림 그리기",
    "text": "2.2 실습 1: 질병 그림 그리기\n\nbasic = basic %&gt;% \n  mutate(disease = -1*hstatus+5, \n         exp.b   = -1*trace.e +50) \n\nfig1 = basic  %&gt;%\n  ggplot(aes(x= exp.b, y = disease))+\n  theme_minimal()+\n  scale_x_continuous(name=\"Biomarker\") +\n  scale_y_continuous(name=\"Disease\") +\n  geom_rect(data=basic[1,],aes(xmin=-Inf, xmax=7 , ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.8) +\n  geom_rect(data=basic[1,],aes(xmin=7,    xmax=15, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.5) +\n  geom_rect(data=basic[1,],aes(xmin=15,   xmax=35, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.3) +\n  geom_rect(data=basic[1,],aes(xmin=35,   xmax=43, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.5) +\n  geom_rect(data=basic[1,],aes(xmin=43,   xmax=52, ymin=-Inf, ymax=Inf), fill= 'grey', alpha=0.8) +\n  geom_point(size=1, color = 'orange') +\n  annotate(geom=\"text\", x=c(3,47),  y=c(3.7, 3.7), label=\"Death\",    color=\"red\") +\n  annotate(geom=\"text\", x=c(10,38), y=c(3.5, 3.5), label=\"Disease\",  color=\"black\") +\n  annotate(geom=\"text\", x=25,       y=3.3,         label=\"Normal Function\",color=\"blue\") \nfig1",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#지역사회-연구-community-base-cohort-study",
    "href": "Dose_Response_Model.html#지역사회-연구-community-base-cohort-study",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.3 지역사회 연구 (community base cohort study)",
    "text": "2.3 지역사회 연구 (community base cohort study)\n지역사회 연구에서는 질병이 있는 사람 또는 기능이 약화된 사람은 병원에 입원해 있는 등 사회생활이 어려우므로 참여하지 못할 수 있습니다. 따라서 장기간 추적 관찰을 하지 않는 경우 바이오마커와 질병간에 U-shap 을 보이게 됩니다. 장기 관찰을 하거나 충분한 관찰을 하면 질병이 새로 생기는 부분을 찾을 수 있으므로 J-shap으로 보일 수 도 있습니다. 우리가 과거력이 있는 사람 또는 적절한 방법으로 건강이 악화되어 있는 사람을 제외하는 경우 바이오마커와 질병의 선형적 관계를 관찰할 수 있는 경우 입니다.\n\nfig1 +\n  annotate(geom=\"text\", x=c(7, 43),  y=c(3.3, 3.3), label=\"Hospital (selection bias)\",  color=\"grey50\") +\n  annotate(geom=\"text\", x=c(10),  y=c(3.8), label=\"Short term follow up\",  color=\"purple\") +\n  geom_segment(aes(x=10, xend=40, y=3.7, yend=3.7), size = 0.5, color='grey50',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\")) +\n  annotate(geom=\"text\", x=c(30),  y=c(4.1), label=\"Long term follow up\",  color=\"purple\") +\n  geom_segment(aes(x=10, xend=50, y=4, yend=4), size = 0.5, color='grey50',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\"))\n\n\n\n\n\n\n\n\n  산업보건에서는 건강한 근로자가 직장을 갖고 직장을 갖은 후에 일에 따라 물리화학적 인자에 노출이 됩니다. 만약 위의 그림에서 바이오마커가 일을하면서 노출되는 유해인자와 관련이 있다면, 사업장에서는 바이오마커가 매우 낮은 사람은 없을 것입니다. 그리고 유해인자에 노출이 많이 되어 질병이 생기고 병원에 가게된다면, 사업장을 중심으로 연구하는 경우 연구대상에 참여하지 못하게 됩니다. 즉 위의 그림에서 short-term follow up 의 상황이 발생하게 됩니다. 그런데 장기간 관찰하고 퇴사후의 자료도 이용한다면 long term follow up 과 같이 가게됩니다. 이때 상관 분석을 수행하면 short-term follow up에서는 U-shap으로, long term follow up 에서는 J-shap 으로 나타나게 됩니다. 실제 연구에서도 비슷한 상황이 발생하기도 합니다. 이때 우리가 얻은 데이터가 무엇을 목적으로 어떠한 설계로 만들어 졌는지를 관찰하고 정말 질병이 생길만한 사람을 제외한 현장에서 연구를 수행하고 있는 것은 아닌지 고민해 보아야 합니다.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#모형-차이-sigmoid-curve-vs-linear-regression",
    "href": "Dose_Response_Model.html#모형-차이-sigmoid-curve-vs-linear-regression",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.4 모형 차이: sigmoid curve vs linear regression",
    "text": "2.4 모형 차이: sigmoid curve vs linear regression\n  위의 그래프를 절반을 나누어서 적절한 기능을 하고 있는 사람만을 대상으로 장기간 추적관찰했다고 가정해 보겠습니다. 그러면 바이오마커와 질병의 관계를 선형으로 예측할 수도 있습니다. 노출이 지속되더라도 건강의 악화는 어느정도 포화될수 있으므로 (모두 다 계속 사망하지는 않으므로) 노출의 크기와 질병의 관계는 sigmoid curve 관계가 있을 수 있습니다.\n  어떤게 좋을까요? 정답은 없지만 LD50을 고려해서 생각해 보겠습니다. LD50이란 노출된 사람 중의 50%가 사망하는 농도를 의미합니다. 즉 LD50가 큰 물질은 적은 물질보다 많이 노출되어야 노출된 사람 중의 50%가 사망하므로 더 안전한 물질입니다.\n\nsigmoid.f = function(x){\n  1/(1+exp(5-x))\n}\n\ndf = tibble(\ndose.e = c(1:10),  \nresp   = sigmoid.f(dose.e)\n)\ndf %&gt;% kbl() %&gt;%\n  kable_paper(\"hover\", full_width = F)\n\n\n\n\ndose.e\nresp\n\n\n\n\n1\n0.0179862\n\n\n2\n0.0474259\n\n\n3\n0.1192029\n\n\n4\n0.2689414\n\n\n5\n0.5000000\n\n\n6\n0.7310586\n\n\n7\n0.8807971\n\n\n8\n0.9525741\n\n\n9\n0.9820138\n\n\n10\n0.9933071\n\n\n\n\n\n\nplot(df)\n\n\n\n\n\n\n\n\nLD50은 설명을 했고, 과도한 비교를 위해서 LD70을 보고 이야기 해보겠습니다.\n\nset.seed(50)\nx&lt;-seq(0, 10, 0.01)\ny&lt;-sigmoid.f(x)+rnorm(length(x), mean=0, sd=0.1)\npb&lt;-c(rnorm(500, 0, 0.001), rnorm(300, 0, 0.01), rnorm(100, 0.1, 0.05),rnorm(101, -0.1, 0.05))\nresp = y + pb\nld70.sm = x[which( sigmoid.f(x) &gt;0.69 & sigmoid.f(x) &lt; 0.71)] %&gt;% min(.)\nld70.sm\n\n[1] 5.81\n\nmod1&lt;-glm(resp ~ poly(x, 1))\npred1&lt;-predict(mod1)\nld70.lm = x[which(pred1 &gt;0.69 & pred1 &lt;0.71)] %&gt;% min(.)\nld70.lm\n\n[1] 6.47\n\ndf = tibble(dose = x, response= resp)\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_line(aes(y= sigmoid.f(dose)), color ='red') +\n  geom_line(aes(y= predict(lm(response ~ poly(dose, 1)))), color ='blue') +\n  geom_vline(xintercept =   5, linetype=2, color='grey50') +\n  geom_hline(yintercept = 0.7, linetype=2, color='grey50') +\n  annotate(geom=\"text\", x=ld70.sm -1,  y=0.9, label=\"LD70\",  \n           color=\"purple\", hjust=1) +\n  geom_segment(aes(x=ld70.sm -1, xend=ld70.sm, y=0.85, yend=0.7), size = 0.1, color='grey30',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\")) +\n  annotate(geom=\"text\", x=ld70.lm +1,  y=0.0, label=\"LD70 by linear assumption\",  \n           color=\"purple\", hjust=0) +\n  geom_segment(aes(x=ld70.lm +1, xend=ld70.lm, y=0.05, yend=0.7), size = 0.1, color='grey30',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\"))\n\n\n\n\n\n\n\n\n가상의 자료입니다. 그래도 중요하게 기억할 점은 선형과 비선형 커브로 할 경우 LD70이 달라지고, 독성에 대한 설명이 달라집니다. 따라서 어떠한 방식으로 설명할지 꼭 고민해야 합니다.  저 농도나 고농도에서는 더 큰 차이가 나타납니다. 그런데 대 부분 저농도의 노동자 들이나 고농도 노출의 노동자가 연구에 참여하기 어려운 상황이 발생합니다. 앞서 계속해서 이야기하는 건강근로자 효과 등을 상기 시켜 봅시다.  그럼 어떤 모델이 가장 적당할 까요? 우선 모델 적합도를 설명도로 비교해 볼 수 있습니다.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#코호트-특성에-따른-상황",
    "href": "Dose_Response_Model.html#코호트-특성에-따른-상황",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.5 코호트 특성에 따른 상황",
    "text": "2.5 코호트 특성에 따른 상황\n첫 수업 시간에 이야기한 것 처럼, 처음에는 질병이 생긴 노동자 위주로 연구가 진행되게 됩니다. 따라서 고농도 노출자 이면서 질병이 있는 사람으로 구성된 데이터에서는 상대적으로 높은 농도에서 질병이 발생하는 연구 결과과 발표 되기도 합니다. 그리고 그림에서 보듯이 선형관계를 고민하지 않는 다면 어디를 기준으로 해야할지 알 수 없는 상태입니다.  결론적으로 위험하다 는 알수 있지만, 얼마나 위험하다는 아직 연구가 되지 않은 상태라는 것을 기억해야 합니다.\n\nearly_cohort = df %&gt;% filter(dose &gt; 5)\n\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_line(aes(y= sigmoid.f(dose)), color ='red') +\n  geom_line(aes(y= predict(lm(response ~ dose))), color ='blue') +\n  geom_vline(xintercept =   5, linetype=2, color='grey50') +\n  geom_hline(yintercept = 0.7, linetype=2, color='grey50') +\n  ## add 1 \n  annotate(geom=\"text\", x=c(7.5),  y=c(-0.2), \n           label=\"Early cohort (hospital base)\",  color=\"purple\", hjust=0) +\n  geom_rect(data=df[1,],aes(xmin=-Inf,   xmax=5, ymin=-Inf, ymax=Inf), \n            fill= 'grey', alpha=0.6) +\n  geom_line(data= early_cohort,\n              aes(y= predict(lm(response ~ poly(dose,3)))), color ='orange', size = 2) +\n   annotate(geom=\"text\", x=ld70.sm -1,  y=0.9, label=\"LD70\",  \n           color=\"purple\", hjust=1) +\n  geom_segment(aes(x=ld70.sm -1, xend=ld70.sm, y=0.85, yend=0.7), size = 0.1, color='grey30',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\")) +\n  annotate(geom=\"text\", x=ld70.lm +1,  y=0.0, label=\"LD70 by linear assumption\",  \n           color=\"purple\", hjust=0) +\n  geom_segment(aes(x=ld70.lm +1, xend=ld70.lm, y=0.05, yend=0.7), size = 0.1, color='grey30',\n               arrow = arrow(length = unit(0.2, \"cm\"), type = \"closed\"))",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#코호트-특성에-따른-상황과-이론적-모델",
    "href": "Dose_Response_Model.html#코호트-특성에-따른-상황과-이론적-모델",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.6 코호트 특성에 따른 상황과 이론적 모델",
    "text": "2.6 코호트 특성에 따른 상황과 이론적 모델\n어느정도 잘 갖추어진 코호트를 생각해 보겠습니다. Dose 2 부터 노출된 사람을 대상으로 하였다고 가정하겠습니다.\n\n# subcohort 2nd phase (1st phase is hospital base cohort)\ns2c &lt;- df %&gt;% filter(dose &gt;2)\ns2m1&lt;-lm(data=s2c, response ~ poly(dose, 1))\ns2m2&lt;-lm(data=s2c, response ~ poly(dose, 2))\ns2m3&lt;-lm(data=s2c, response ~ poly(dose, 3))\ns2m4&lt;-lm(data=s2c, response ~ poly(dose, 4))\n\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_point(data=s2c, color = 'grey40', size =2   ) +\n  geom_line(data=s2c, aes(y=predict(s2m1)), color = 'chocolate1', size = 1) +\n  geom_line(data=s2c, aes(y=predict(s2m2)), color = 'chartreuse1', size = 1) +\n  geom_line(data=s2c, aes(y=predict(s2m3)), color = 'cadetblue1', size = 1) +\n  geom_line(data=s2c, aes(y=predict(s2m4)), color = 'deeppink1', size = 1) \n\n\n\n\n\n\n\n\n모델로 보면 선형 예측이 모형 적합도가 가장 낮다(low)고 나타나고 차수가 높을 수록 좋다고 나타나고 있습니다. 그런데, 어떤게 더 맞을 까요?.\n\nanova(s2m1, s2m2, s2m3, s2m4) \n\nAnalysis of Variance Table\n\nModel 1: response ~ poly(dose, 1)\nModel 2: response ~ poly(dose, 2)\nModel 3: response ~ poly(dose, 3)\nModel 4: response ~ poly(dose, 4)\n  Res.Df     RSS Df Sum of Sq        F  Pr(&gt;F)    \n1    798 18.9099                                  \n2    797 13.4734  1    5.4365 440.8574 &lt; 2e-16 ***\n3    796  9.8806  1    3.5928 291.3455 &lt; 2e-16 ***\n4    795  9.8036  1    0.0770   6.2423 0.01267 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n만약 농도가 높을 때 낮아지고 있는 부분을 고려한다면 어떻게 될까요? (실제로도 농도가 높은 곳에 근무하는 노동자는 만성 질병이 일어나기 전에 손상으로 사망하는 연구가 있습니다. ) 따라서 그런 산업보건적 특성을 고려하면 어떻게 될 까요? 단순하게 9 이상 농도를 고려하지 않도록 하겠습니다.\n\ns3c &lt;- df %&gt;% filter(dose &gt;2) %&gt;% filter(dose &lt;9)\ns3m1&lt;-lm(data=s3c, response ~ poly(dose, 1))\ns3m2&lt;-lm(data=s3c, response ~ poly(dose, 2))\ns3m3&lt;-lm(data=s3c, response ~ poly(dose, 3))\ns3m4&lt;-lm(data=s3c, response ~ poly(dose, 4))\n\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_point(data=s3c, color = 'grey40', size =2   ) +\n  #geom_line(data=s2c, aes(y=predict(s2m1)), color = 'grey30', size = 1) +\n  geom_line(data=s2c, aes(y=predict(s2m4)), color = 'grey30', size = 1) +\n  #geom_line(data=s3c, aes(y=predict(s3m1)), color = 'orange', size = 1) \n  geom_line(data=s3c, aes(y=predict(s3m4)), color = 'orange', size = 1) \n\n\n\n\n\n\n\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_point(data=s3c, color = 'grey40', size =2   ) +\n  geom_line(data=s2c, aes(y=predict(s2m1)), color = 'grey30', size = 1) +\n  #geom_line(data=s2c, aes(y=predict(s2m4)), color = 'grey30', size = 1) +\n  geom_line(data=s3c, aes(y=predict(s3m1)), color = 'orange', size = 1) \n\n\n\n\n\n\n\n  #geom_line(data=s3c, aes(y=predict(s3m4)), color = 'orange', size = 1) \n\n3차 이상의 모형에서는 큰 차이가 나지 않지만, 선형 모형에서는 차이가 상당합니다. 어떤 것이 더 맞다는 것은 아직 논할 단계는 아니고, 차이가 있다는 것을 기억하면 좋겠습니다. 그래서 실제 보고하고 적용할 때 현장에 더 적합한 것이 무엇인지, 목적이 보호 인지, 보상인지 등을 고려하여 해야 겠습니다.\n\nlibrary(gam)\n######전체 자료 실습\ns4c = df %&gt;% filter(dose &lt;9)\ns4m1&lt;-lm(data=s4c, response ~ poly(dose, 1))\ns4m3&lt;-lm(data=s4c, response ~ poly(dose, 3))\ns4ms&lt;-lm(data=s4c, response ~ sigmoid.f(dose-5))\ns4mg&lt;-gam(data=s4c, response ~ s(dose, 20))\nanova(s4m1, s4m3, s4ms, s4mg)\n\nAnalysis of Variance Table\n\nModel 1: response ~ poly(dose, 1)\nModel 2: response ~ poly(dose, 3)\nModel 3: response ~ sigmoid.f(dose - 5)\nModel 4: response ~ s(dose, 20)\n  Res.Df    RSS     Df Sum of Sq       F    Pr(&gt;F)    \n1    898 14.876                                       \n2    896 10.064  2.000     4.812  233.61 &lt; 2.2e-16 ***\n3    898 67.272 -2.000   -57.208 2777.26 &lt; 2.2e-16 ***\n4    879  9.053 18.999    58.219  297.52 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\ndf %&gt;%\n  ggplot(aes(x=dose, y=response)) +\n  geom_point(color = 'grey80') + theme_minimal()+\n  geom_point(data=s4c, color = 'grey40', size =2   ) +\n  geom_line(data=s4c, aes(y=predict(s4m1)), color = 'grey10', size = 1) +\n  geom_line(data=s4c, aes(y=predict(s4m3)), color = 'grey30', size = 1) +\n  geom_line(data=s4c, aes(y=predict(s4ms)), color = 'deepskyblue', size = 1) +\n  geom_line(data=s4c, aes(y=predict(s4mg)), color = 'orange', size = 1) \n\n\n\n\n\n\n\n\n\n2.6.1 Take home message\n\n고 노출 집단:\n\n\n높은 표준 사망비(SMR)에도 불구하고 용량 증가에 따른 질병 발생 증가 경향이 명확하지 않을 수 있습니다. 즉, 선형적인 용량-반응 관계가 나타나지 않을 수 있습니다.\n\n\n중간 용량 노출 집단:\n\n\n용량-반응 관계가 관찰되지만, 건강한 노동자 효과로 인해 실제 관계가 약화될 수 있습니다. 즉, 실제보다 용량과 질병 발생 간의 연관성이 낮게 나타날 수 있습니다.\n\n\n전체 용량 노출 집단:\n\n\n용량-반응 관계를 분석하고, 건강한 노동자 효과를 통제하여 더욱 정확한 결과를 얻을 수 있습니다.\n모델 선택 과정에서 LD50(반수 치사량)의 과대 또는 과소 평가가 발생할 수 있으므로 주의해야 합니다.\n최적의 모델이라 하더라도, 건강한 노동자 효과로 인한 데이터 편향 때문에 실제 질병 발생 양상을 완벽하게 반영하지 못할 수 있습니다.\n\n\n권고 사항: 기존 모델에 의존하기보다는, 연구 특성에 맞는 자체적인 용량-반응 모델을 개발하여 적용하는 것이 바람직합니다.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  },
  {
    "objectID": "Dose_Response_Model.html#threshold-찾기-change-point-찾기",
    "href": "Dose_Response_Model.html#threshold-찾기-change-point-찾기",
    "title": "2  용량-반응 관계 기본 실습",
    "section": "2.7 Threshold 찾기 (change point 찾기)",
    "text": "2.7 Threshold 찾기 (change point 찾기)\nthreshold를 찾는 방법 중에 threshold point마다, piecewise regression을 반복해서 구하고, 최적의 모델을 찾는 방법을 사용할 수 있습니다. piecewise regression 의 간단한 설명은 다음과 같습니다\n\n\n\n\n\n\n\nthreshold points (piecewise regression)\ncodes\n\n\n\n\ntotal\nResp = α + β1 · Dose + β2 ·( Dose – Ɵ) + + Ɛ0\n\n\nIf Dose &lt; Ɵ\nResp= α + β1 · Dose + Ɛ0\n\n\nIf Dose &gt; Ɵ\nResp= α - β2 ·Ɵ +( β1 + β2 )· Dose + Ɛ0\n\n\nmodel selection\nminimal AIC value\n\n\n\n\n2.7.1 자료 생성\n아래 처럼 임로 데이터를 생성해 보았습니다. 어떤 유해물질 노출 (Dose) 에 따라 건강영향 (Resp) 가 나타났다고 생각해 보겠습니다. 그리고 일정량에서 threshold가 있다고 생각해보겠습니다.\n\nset.seed(0)\ndose &lt;- seq(0,10, 0.1)\nlength(dose)\n\n[1] 101\n\npb&lt;-c(rnorm(50, 0, 0.001), rnorm(30, 0, 0.01), rnorm(10, 0.1, 0.05),rnorm(11, -0.1, 0.05))\nresp &lt;-1/(1+exp(-(dose-5)))+rnorm(length(dose), 0, 0.1)+pb\n\nplot(dose, resp, xlab='Dose', ylab='Response', cex.lab=1.5, cex.axis=1.5, cex.main=1.5, cex.sub=1.5)\n\n\n\n\n\n\n\ncohort&lt;-data.frame(dose, resp, pb)\n\n\n\n2.7.2 가상의 threshold 값 수행해보기\n한 1에서 5 사이에 있어 보입니다. 이를 통해 예상되는 matrix (outdata)를 구해보았습니다. outdata의 행의 이름을 threshold point에 따라 intercept, beta for before threshold, and its p value, beta for post threshold and its pvalue와 그때은 AIC 값을 구해보겠습니다 . 우선 하나만 구해보겠습니다. therhold가 1일때와 5일때를 를 가정해 보겠습니다.\n\ncpdose &lt;- ifelse(dose -1 &gt;0, dose -1, 0)\ncpm &lt;- glm(resp ~ dose + cpdose)\nsummary(cpm)$aic\n\n[1] -92.20184\n\n\n\ncpdose &lt;- ifelse(dose -5 &gt;0, dose -5, 0)\ncpm &lt;- glm(resp ~ dose + cpdose)\nsummary(cpm)$aic\n\n[1] -86.9744\n\n\n어떤 가정이 모델 적합도를 높이나요? 네 threshold가 1일 때 입니다. 그럼 2랑도, 2.5랑도 비교해 봐야겠지요. 이때 반복 분석을 수행해보도록 하겠습니다.\n위의 모델을 함수로 만들었습니다\n\nthr_fun &lt;- function(thres){\ncpdose &lt;- ifelse(dose - thres &gt;0, dose - thres, 0)\ncpm    &lt;- glm(resp ~ dose + cpdose)\naic    &lt;- summary(cpm)$aic\ndata.frame(\n  'threshold' = thres,\n  'aic'       = aic)\n}\n\n이것을 돌릴 범위를 정해보겠습니다.\n\n# 이게 어떤 의미 일까요?\ndose[which(dose == 1):which(dose == 5)]\n\n [1] 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8\n[20] 2.9 3.0 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 4.0 4.1 4.2 4.3 4.4 4.5 4.6 4.7\n[39] 4.8 4.9 5.0\n\n\n이제 반복해서 작업해 보겠습니다.\n\nsimul_list &lt;- list()\nsimul_list &lt;- lapply(dose[which(dose ==1):which(dose ==5)],                     thr_fun\n                     )\n\n이제 데이터 프레임으로 만들어 보겠습니다.\n\nsimul_dat &lt;- do.call(rbind, simul_list)\n\n그림을 그려보겠습니다.\n\nlibrary(ggplot2)\nopt.thres &lt;- simul_dat$threshold[which.min(simul_dat$aic)]\n\nsimul_dat %&gt;%\n  ggplot(aes(x = threshold, y = aic)) +\n  geom_line() +\n  geom_vline(xintercept = opt.thres) +\n  geom_text(x = opt.thres + 0.8, y = -90, color = 'red', \n            label = paste0(round(opt.thres, 3), '점에서 최소 AIC를 보입니다.' )) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n즉 2.1에서 threshold를 잡아 모델을 그리면 가장 적합함을 알 수 있습니다.\n\nthres = 2.1\nf_cpdose &lt;- ifelse(dose - thres &gt;0, dose - thres, 0)\nf_cpm    &lt;- glm(resp ~ dose + f_cpdose)\n\n\nprepwlm &lt;- predict(f_cpm)\nscaleFUN &lt;- function(x) sprintf(\"%.2f\", x)\ncohort %&gt;%\n  ggplot(aes(x= dose, y = resp)) +\n  geom_point() +\n  theme_minimal() +\n  scale_y_continuous(labels = scaleFUN) +\n  geom_line(aes(y = prepwlm), color ='red')\n\n\n\n\n\n\n\n\n만약 threshold 전에는 질병이 생기지 않는다고 가정하면 어떻게 될가요? dose 대신 predose 를 넣어 주면 됩니다.\n\nthres = 2.1\nf_cpdose &lt;- ifelse(dose - thres &gt;=0, dose - thres, 0)\nf_predose &lt;- ifelse(dose - thres &lt;=0, 0, dose - thres )\nf_cpm    &lt;- glm(resp ~ f_predose + f_cpdose)\n\n\nprepwlm &lt;- predict(f_cpm)\nscaleFUN &lt;- function(x) sprintf(\"%.2f\", x)\ncohort %&gt;%\n  ggplot(aes(x= dose, y = resp)) +\n  geom_point() +\n  theme_minimal() +\n  scale_y_continuous(labels = scaleFUN) +\n  geom_line(aes(y = prepwlm), color ='red')",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>용량-반응 관계 기본 실습</span>"
    ]
  }
]