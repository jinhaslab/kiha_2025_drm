<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; 중단된 시계열 분석 – 직업환경연구방법</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Jobstress.html" rel="next">
<link href="./timeseries_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-a8378a0342da607bf6aa9ac04725c156.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-424117795b1f6bc5b90be9cdae97709d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./InterruptedTS.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">중단된 시계열 분석</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">직업환경연구방법</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">소개</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">개요</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MetaAnalysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">메타분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Dose_Response_Model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dose Response Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timeseries_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">시계열분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./InterruptedTS.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">중단된 시계열 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Jobstress.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">job stress questionnaires</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Interraction_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">상호작용</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#서론" id="toc-서론" class="nav-link active" data-scroll-target="#서론"><span class="header-section-number">5.1</span> 서론</a></li>
  <li><a href="#통제되지-않은-its-uncontrolled-its-단일-개입" id="toc-통제되지-않은-its-uncontrolled-its-단일-개입" class="nav-link" data-scroll-target="#통제되지-않은-its-uncontrolled-its-단일-개입"><span class="header-section-number">5.2</span> 통제되지 않은 ITS (Uncontrolled ITS), 단일 개입</a></li>
  <li><a href="#기본-its-모델-구축" id="toc-기본-its-모델-구축" class="nav-link" data-scroll-target="#기본-its-모델-구축"><span class="header-section-number">5.3</span> 기본 ITS 모델 구축:</a>
  <ul class="collapse">
  <li><a href="#모델-예측값-및-신뢰-구간-추가" id="toc-모델-예측값-및-신뢰-구간-추가" class="nav-link" data-scroll-target="#모델-예측값-및-신뢰-구간-추가"><span class="header-section-number">5.3.1</span> 모델 예측값 및 신뢰 구간 추가:</a></li>
  <li><a href="#자기상관-autocorrelation-처리" id="toc-자기상관-autocorrelation-처리" class="nav-link" data-scroll-target="#자기상관-autocorrelation-처리"><span class="header-section-number">5.3.2</span> 자기상관 (Autocorrelation) 처리:</a></li>
  <li><a href="#반사실적-모델-counterfactual-model-구축" id="toc-반사실적-모델-counterfactual-model-구축" class="nav-link" data-scroll-target="#반사실적-모델-counterfactual-model-구축"><span class="header-section-number">5.3.3</span> 반사실적 모델 (Counterfactual Model) 구축:</a></li>
  <li><a href="#개입-효과의-크기-추정" id="toc-개입-효과의-크기-추정" class="nav-link" data-scroll-target="#개입-효과의-크기-추정"><span class="header-section-number">5.3.4</span> 개입 효과의 크기 추정:</a></li>
  </ul></li>
  <li><a href="#통제되지-않은-its-uncontrolled-its-두-번의-개입" id="toc-통제되지-않은-its-uncontrolled-its-두-번의-개입" class="nav-link" data-scroll-target="#통제되지-않은-its-uncontrolled-its-두-번의-개입"><span class="header-section-number">5.4</span> 통제되지 않은 ITS (Uncontrolled ITS), 두 번의 개입</a>
  <ul class="collapse">
  <li><a href="#반사실적-시나리오-분석-두-번의-개입" id="toc-반사실적-시나리오-분석-두-번의-개입" class="nav-link" data-scroll-target="#반사실적-시나리오-분석-두-번의-개입"><span class="header-section-number">5.4.1</span> 반사실적 시나리오 분석 (두 번의 개입):</a></li>
  <li><a href="#사실적-모델과-반사실적-모델-비교-시각화-두-번의-개입" id="toc-사실적-모델과-반사실적-모델-비교-시각화-두-번의-개입" class="nav-link" data-scroll-target="#사실적-모델과-반사실적-모델-비교-시각화-두-번의-개입"><span class="header-section-number">5.4.2</span> 사실적 모델과 반사실적 모델 비교 시각화 (두 번의 개입):</a></li>
  <li><a href="#개입-효과-크기-계산-두-번의-개입" id="toc-개입-효과-크기-계산-두-번의-개입" class="nav-link" data-scroll-target="#개입-효과-크기-계산-두-번의-개입"><span class="header-section-number">5.4.3</span> 개입 효과 크기 계산 (두 번의 개입):</a></li>
  </ul></li>
  <li><a href="#파트-3-통제된-its-단일-개입" id="toc-파트-3-통제된-its-단일-개입" class="nav-link" data-scroll-target="#파트-3-통제된-its-단일-개입"><span class="header-section-number">5.5</span> 파트 3: 통제된 ITS, 단일 개입</a>
  <ul class="collapse">
  <li><a href="#통제된-its-모델-구축" id="toc-통제된-its-모델-구축" class="nav-link" data-scroll-target="#통제된-its-모델-구축"><span class="header-section-number">5.5.1</span> 통제된 ITS 모델 구축:</a></li>
  <li><a href="#대안적인-모델-구축-상호작용-항-사용" id="toc-대안적인-모델-구축-상호작용-항-사용" class="nav-link" data-scroll-target="#대안적인-모델-구축-상호작용-항-사용"><span class="header-section-number">5.5.2</span> 대안적인 모델 구축 (상호작용 항 사용):</a></li>
  <li><a href="#반사실적-시나리오-분석" id="toc-반사실적-시나리오-분석" class="nav-link" data-scroll-target="#반사실적-시나리오-분석"><span class="header-section-number">5.5.3</span> 반사실적 시나리오 분석:</a></li>
  <li><a href="#통제-그룹의-효과-평가" id="toc-통제-그룹의-효과-평가" class="nav-link" data-scroll-target="#통제-그룹의-효과-평가"><span class="header-section-number">5.5.4</span> 통제 그룹의 효과 평가:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">중단된 시계열 분석</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="서론" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="서론"><span class="header-section-number">5.1</span> 서론</h2>
<p>오늘 강의에서는 중단된 시계열 분석(Interrupted Time Series, ITS)이라는 강력한 통계 기법을 소개하고, 이를 산업보건 분야에 어떻게 적용할 수 있는지 살펴보겠습니다. ITS 분석은 특정 개입(intervention)이 시계열 데이터에 미치는 영향을 평가하는 데 사용됩니다.</p>
<p>참고자료: https://rpubs.com/chrissyhroberts/1006858</p>
<p>강의 내용:</p>
<p>본 강의에서는 다음과 같은 세 가지 주요 유형의 ITS 분석을 예시와 함께 설명합니다. 각 예시에서는 산업보건 상황을 가정하여 데이터 생성부터 모델링, 결과 해석까지의 전 과정을 단계별로 안내합니다.</p>
<ul>
<li>파트 1: 통제되지 않은 ITS (Uncontrolled ITS), 단일 개입</li>
<li>파트 2: 통제되지 않은 ITS (Uncontrolled ITS), 두 번의 개입</li>
<li>파트 3: 통제된 ITS (Controlled ITS), 단일 개입</li>
</ul>
<blockquote class="blockquote">
<p>핵심 개념: 반사실적 시나리오 (Counterfactual Scenario)</p>
</blockquote>
<p>ITS 분석의 핵심은 반사실적 시나리오의 개념입니다. 우리는 실제로 발생한 사건(사실적 시나리오)을 모델링하고, 만약 개입이 없었다면 어떤 일이 발생했을지(반사실적 시나리오)를 추정합니다. 그리고 사실적 시나리오와 반사실적 시나리오를 비교하여 개입의 영향을 평가합니다.</p>
<p>예를 들어, 공장의 작업 환경 개선을 위한 새로운 안전 수칙 도입이 산업재해 발생 건수에 미치는 영향을 평가한다고 가정해 봅시다. ITS 분석을 통해 안전 수칙 도입 후의 실제 산업재해 발생 건수 변화를 모델링하고, 만약 안전 수칙이 도입되지 않았다면 산업재해 발생 건수가 어떻게 변화했을지를 추정하여 그 차이를 분석합니다.</p>
<p>개입으로 인한 변화의 유형 개입으로 인해 데이터에서 나타날 수 있는 변화는 다음과 같은 두 가지 주요 형태를 가질 수 있습니다.</p>
<ul>
<li>단계 변화 (Step Change): 개입 직후 즉각적이고 급격한 변화. 예를 들어, 새로운 안전 장비 도입으로 인해 산업재해 발생 건수가 갑자기 감소하는 경우입니다.</li>
<li>추세 변화 (Slope/Trend Change): 개입 이후 데이터의 추세가 변화하는 것. 예를 들어, 건강 증진 프로그램 시행 후 시간이 지남에 따라 근로자들의 결근율이 점진적으로 감소하거나, 초기 감소 후 다시 증가하는 경우도 있을 수 있습니다.</li>
</ul>
<p>실제 산업보건 상황을 고려하여 어떤 유형의 변화가 발생할 가능성이 있는지 신중하게 판단하고, 이에 맞는 모델을 구축해야 합니다</p>
</section>
<section id="통제되지-않은-its-uncontrolled-its-단일-개입" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="통제되지-않은-its-uncontrolled-its-단일-개입"><span class="header-section-number">5.2</span> 통제되지 않은 ITS (Uncontrolled ITS), 단일 개입</h2>
<p>가장 기본적인 형태의 ITS 분석으로, 하나의 개입이 단일 결과 변수에 미치는 영향을 평가합니다.</p>
<p>가상 데이터 생성:</p>
<ul>
<li>다음은 가상의 산업보건 데이터를 생성하는 R 코드입니다. 특정 작업장의 주간 산업재해 발생 건수를 측정했으며, 51주차에 새로운 안전 교육 프로그램을 도입했다고 가정합니다.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 개입 시점: 51주차</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="co"># 연구 주 (1 - 100주)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">50</span>)), <span class="co"># 개입 여부 (개입 전: 0, 개입 후: 1)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post.intervention.time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>), <span class="co"># 개입 후 경과 시간</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">quantity.x =</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="co"># 개입 전 주간 재해 건수 (가상 데이터)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">50</span>, <span class="at">replace =</span> T))) <span class="co"># 개입 후 주간 재해 건수 (가상 데이터)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">100</span>, <span class="at">scrollY =</span> <span class="st">"200px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ed36ab83dce7370e4615" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ed36ab83dce7370e4615">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[44,49,48,50,51,50,41,45,46,37,43,41,37,38,37,33,38,39,37,34,33,39,39,32,28,30,30,29,29,31,29,27,35,32,28,31,28,31,21,21,19,26,21,27,17,21,15,21,15,20,20,32,29,31,33,17,33,24,19,17,20,22,29,25,30,32,21,18,30,29,17,20,12,17,12,19,26,21,20,25,20,14,7,11,19,16,19,5,14,15,7,15,-2,7,0,16,-4,15,14,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Time<\/th>\n      <th>Intervention<\/th>\n      <th>Post.intervention.time<\/th>\n      <th>quantity.x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":100,"scrollY":"200px","columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Time","targets":1},{"name":"Intervention","targets":2},{"name":"Post.intervention.time","targets":3},{"name":"quantity.x","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>위 코드는 다음과 같은 변수를 포함하는 데이터 프레임을 생성합니다.</p>
<ul>
<li>Time: 연구가 진행된 주차 (1부터 100까지).</li>
<li>Intervention: 개입이 발생했는지 여부를 나타내는 이진 변수 (개입 전 50주 동안은 0, 개입 후 50주 동안은 1).</li>
<li>Post.intervention.time: 개입이 발생한 후 경과된 시간 (개입 전에는 0, 개입 후에는 1부터 50까지).</li>
<li>quantity.x: 우리가 측정하고자 하는 결과 변수 (여기서는 주간 산업재해 발생 건수).</li>
</ul>
</section>
<section id="기본-its-모델-구축" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="기본-its-모델-구축"><span class="header-section-number">5.3</span> 기본 ITS 모델 구축:</h2>
<p>가장 단순한 형태의 ITS 모델은 일반화 최소 제곱(Generalized Least Squares, GLS) 회귀 분석을 사용하여 구축할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model.a <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention <span class="sc">+</span> Post.intervention.time, <span class="at">data =</span> df, <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: quantity.x ~ Time + Intervention + Post.intervention.time 
  Data: df 
       AIC      BIC    logLik
  613.0613 626.0871 -301.5306

Coefficients:
                          Value Std.Error   t-value p-value
(Intercept)            48.60082 1.4462745  33.60414  0.0000
Time                   -0.61729 0.0493606 -12.50566  0.0000
Intervention           12.26190 2.0153402   6.08428  0.0000
Post.intervention.time  0.15539 0.0698065   2.22601  0.0284

 Correlation: 
                       (Intr) Time   Intrvn
Time                   -0.870              
Intervention            0.348 -0.600       
Post.intervention.time  0.615 -0.707 -0.017

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-2.49017923 -0.67118359  0.02948247  0.79956857  1.90310826 

Residual standard error: 4.935074 
Degrees of freedom: 100 total; 96 residual</code></pre>
</div>
</div>
<p>모델의 계수는 다음과 같은 의미를 갖습니다.</p>
<ul>
<li>(Itercept): 연구 시작 시점의 quantity.x의 추정 값.</li>
<li>Time: 개입 전 시간의 흐름에 따른 quantity.x의 변화 추세 (주당 변화량).</li>
<li>Intervention: 개입 시점에서의 즉각적인 단계 변화 크기.</li>
<li>Post.intervention.time: 개입 이후 시간의 흐름에 따른 quantity.x의 변화 추세 변화량 (개입 전 추세에 추가되는 주당 변화량).</li>
</ul>
<section id="모델-예측값-및-신뢰-구간-추가" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="모델-예측값-및-신뢰-구간-추가"><span class="header-section-number">5.3.1</span> 모델 예측값 및 신뢰 구간 추가:</h3>
<p>모델에서 예측된 값과 표준 오차를 데이터 프레임에 추가하여 시각화하고 신뢰 구간을 계산할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.a.predictions =</span> <span class="fu">predictSE.gls</span>(model.a, df, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.a.se =</span> <span class="fu">predictSE.gls</span>(model.a, df, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.a.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.a.se), <span class="at">ymax =</span> model.a.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.a.se)), <span class="at">fill =</span> <span class="st">"lightgreen"</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.a.predictions), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="자기상관-autocorrelation-처리" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="자기상관-autocorrelation-처리"><span class="header-section-number">5.3.2</span> 자기상관 (Autocorrelation) 처리:</h3>
<p>시계열 데이터는 종종 자기상관이라는 특성을 가집니다. 이는 특정 시점의 값이 이전 시점의 값과 상관 관계를 갖는 현상입니다. 자기상관을 무시하면 모델 추정치의 효율성과 신뢰성이 저하될 수 있습니다.</p>
<p>GLS 모델에서는 corARMA 함수를 사용하여 자기상관을 고려할 수 있습니다. p는 자기 회귀 차수(autoregressive order), q는 이동 평균 차수(moving average order)를 나타냅니다. 적절한 p와 q 값을 선택하는 것은 중요하며, AIC (Akaike Information Criterion)와 같은 정보 기준을 사용하여 최적의 모델을 선택할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 자기상관 모델 구축 및 AIC 비교 함수</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mod<span class="fl">.1</span> <span class="ot">&lt;-</span> quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention <span class="sc">+</span> Post.intervention.time</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fx <span class="ot">&lt;-</span> <span class="cf">function</span>(pval, qval) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">gls</span>(mod<span class="fl">.1</span>, <span class="at">data =</span> df, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> pval, <span class="at">q =</span> qval, <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>))<span class="sc">$</span>AIC</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 비상관 모델의 AIC</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">gls</span>(mod<span class="fl">.1</span>, <span class="at">data =</span> df, <span class="at">method =</span> <span class="st">"ML"</span>))<span class="sc">$</span>AIC</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">str_c</span>(<span class="st">"AIC Uncorrelated model = "</span>, p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>AIC Uncorrelated model = 613.06125479172</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p와 q의 다양한 조합에 대한 AIC 계산</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>autocorrel <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">pval =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">qval =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(autocorrel)) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  p[i] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">summary</span>(<span class="fu">gls</span>(mod<span class="fl">.1</span>, <span class="at">data =</span> df, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> autocorrel<span class="sc">$</span>pval[i], <span class="at">q =</span> autocorrel<span class="sc">$</span>qval[i], <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>))<span class="sc">$</span>AIC)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>autocorrel <span class="ot">&lt;-</span> autocorrel <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">as.numeric</span>(p)) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>autocorrel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pval qval      AIC
1    0    0 613.0613
2    1    0 615.0468
3    0    1 615.0496
4    0    2 615.5883
5    2    0 615.6401
6    1    1 616.2963
7    2    1 617.1825
8    1    2 617.3935
9    2    2 619.0693</code></pre>
</div>
</div>
<p>AIC 값이 가장 낮은 모델이 데이터에 가장 적합한 자기상관 구조를 나타냅니다. 최적의 p와 q 값을 사용하여 최종 모델을 구축합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 최적의 p=2, q=2를 적용한 모델</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model.b <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention <span class="sc">+</span> Post.intervention.time, <span class="at">data =</span> df, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">q =</span> <span class="dv">2</span>, <span class="at">form =</span> <span class="sc">~</span> Time))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model.a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)                   Time           Intervention 
            48.6008163             -0.6172869             12.2618968 
Post.intervention.time 
             0.1553902 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model.b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)                   Time           Intervention 
            48.5763444             -0.6162835             12.2327330 
Post.intervention.time 
             0.1540193 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델 b의 예측값 및 표준 오차 추가</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.b.predictions =</span> <span class="fu">predictSE.gls</span>(model.b, df, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.b.se =</span> <span class="fu">predictSE.gls</span>(model.b, df, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="반사실적-모델-counterfactual-model-구축" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="반사실적-모델-counterfactual-model-구축"><span class="header-section-number">5.3.3</span> 반사실적 모델 (Counterfactual Model) 구축:</h3>
<p>개입이 없었다면 어떤 일이 발생했을지를 추정하기 위해 반사실적 모델을 구축합니다. 이는 개입 이전의 데이터만을 사용하여 시간 추세를 모델링하고, 이를 개입 이후 시점까지 외삽하는 방식으로 이루어집니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 개입 이전 데이터 필터링</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df, Time <span class="sc">&lt;</span> <span class="dv">51</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 반사실적 모델 구축</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>model.c <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time, <span class="at">data =</span> df2, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model.a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)                   Time           Intervention 
            48.6008163             -0.6172869             12.2618968 
Post.intervention.time 
             0.1553902 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model.c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Time 
  48.545253   -0.615377 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 반사실적 모델 예측값 및 표준 오차 추가</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.c.predictions =</span> <span class="fu">predictSE.gls</span>(model.c, <span class="at">newdata =</span> df, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.c.se =</span> <span class="fu">predictSE.gls</span>(model.c, df, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>사실적 모델과 반사실적 모델 비교 시각화:</p>
</blockquote>
<p>사실적 모델과 반사실적 모델의 예측값 및 신뢰 구간을 함께 시각화하여 개입의 영향을 평가합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.c.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.c.se), <span class="at">ymax =</span> model.c.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.c.se)), <span class="at">fill =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.c.predictions), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.b.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.b.se), <span class="at">ymax =</span> model.b.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.b.se)), <span class="at">fill =</span> <span class="st">"lightgreen"</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.b.predictions), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>만약 사실적 모델의 신뢰 구간과 반사실적 모델의 신뢰 구간이 겹치지 않는다면, 개입이 결과 변수에 통계적으로 유의미한 영향을 미쳤다고 해석할 수 있습니다. 또한, 두 선의 차이가 시간이 지남에 따라 벌어진다면, 개입이 추세 변화를 유발했을 가능성을 시사합니다.</p>
</section>
<section id="개입-효과의-크기-추정" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="개입-효과의-크기-추정"><span class="header-section-number">5.3.4</span> 개입 효과의 크기 추정:</h3>
<p>사실적 모델의 예측값에서 반사실적 모델의 예측값을 빼서 각 시점에서의 개입 효과 크기를 추정할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(df<span class="sc">$</span>model.b.predictions <span class="sc">-</span> df<span class="sc">$</span>model.c.predictions, <span class="at">scientific =</span> F)[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">51</span>, <span class="dv">100</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              1              50              51             100 
" 0.0301844808" "-0.0142302631" "12.3716156541" "19.8741489561" </code></pre>
</div>
</div>
</section>
</section>
<section id="통제되지-않은-its-uncontrolled-its-두-번의-개입" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="통제되지-않은-its-uncontrolled-its-두-번의-개입"><span class="header-section-number">5.4</span> 통제되지 않은 ITS (Uncontrolled ITS), 두 번의 개입</h2>
<p>ITS 모델은 여러 번의 개입이 있는 경우에도 확장하여 적용할 수 있습니다. 예를 들어, 산업보건 개입이 여러 단계로 이루어지거나, 예상치 못한 사건이 발생하는 경우를 분석할 수 있습니다.</p>
<blockquote class="blockquote">
<p>가상 데이터 생성:</p>
</blockquote>
<p>다음은 두 번의 개입이 있는 가상 데이터를 생성하는 R 코드입니다. 첫 번째 안전 교육 프로그램 도입(51주차)과 추가적인 작업 환경 개선(101주차)이 주간 산업재해 발생 건수에 미치는 영향을 평가한다고 가정합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 두 번의 개입 시점: 51주차, 101주차</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">100</span>)), <span class="co"># 첫 번째 개입 여부</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post.intervention.time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>), <span class="co"># 첫 번째 개입 후 경과 시간</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intervention.2 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">50</span>)), <span class="co"># 두 번째 개입 여부</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post.intervention.2.time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>), <span class="co"># 두 번째 개입 후 경과 시간</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quantity.x =</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">40</span><span class="sc">:</span><span class="dv">70</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">50</span>, <span class="at">replace =</span> T),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">45</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">50</span>, <span class="at">replace =</span> T)),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> F) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">50</span>, <span class="at">replace =</span> T)))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df3, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">100</span>, <span class="at">scrollY =</span> <span class="st">"200px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-855b4412d7df571fc9ed" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-855b4412d7df571fc9ed">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[74,65,72,71,64,65,70,64,64,59,59,63,69,61,60,60,62,60,60,61,59,51,57,56,49,55,48,55,55,47,50,52,53,49,48,46,44,50,45,46,50,50,44,43,44,42,36,44,35,41,55,45,43,53,38,46,39,32,50,34,30,34,26,39,42,40,26,43,37,35,26,35,21,38,35,34,30,28,18,33,19,27,21,14,15,29,16,19,22,12,15,30,9,22,26,26,12,17,7,25,0,1,6,8,11,7,11,4,12,11,7,10,18,11,17,16,20,15,13,17,15,21,14,17,18,19,20,25,19,23,16,19,24,18,27,22,22,20,22,28,25,24,33,24,24,23,28,33,25,29]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Time<\/th>\n      <th>Intervention<\/th>\n      <th>Post.intervention.time<\/th>\n      <th>Intervention.2<\/th>\n      <th>Post.intervention.2.time<\/th>\n      <th>quantity.x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":100,"scrollY":"200px","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Time","targets":1},{"name":"Intervention","targets":2},{"name":"Post.intervention.time","targets":3},{"name":"Intervention.2","targets":4},{"name":"Post.intervention.2.time","targets":5},{"name":"quantity.x","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<blockquote class="blockquote">
<p>ITS 모델 구축:</p>
</blockquote>
<p>두 번의 개입을 고려한 ITS 모델은 다음과 같이 구축할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model.d <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention <span class="sc">+</span> Post.intervention.time <span class="sc">+</span> Intervention<span class="fl">.2</span> <span class="sc">+</span> Post.intervention.<span class="fl">2.</span>time,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df3, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">q =</span> <span class="dv">2</span>, <span class="at">form =</span> <span class="sc">~</span> Time))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: quantity.x ~ Time + Intervention + Post.intervention.time + Intervention.2 +      Post.intervention.2.time 
  Data: df3 
       AIC      BIC    logLik
  899.3558 932.4728 -438.6779

Correlation Structure: ARMA(2,2)
 Formula: ~Time 
 Parameter estimate(s):
      Phi1       Phi2     Theta1     Theta2 
-0.9905240 -0.9437959  0.8928560  0.9050067 

Coefficients:
                            Value Std.Error   t-value p-value
(Intercept)              70.22011 1.2568025  55.87204  0.0000
Time                     -0.61536 0.0428838 -14.34937  0.0000
Intervention              6.21757 1.7500652   3.55276  0.0005
Post.intervention.time   -0.02452 0.0606429  -0.40441  0.6865
Intervention.2           -8.00397 1.7500783  -4.57349  0.0000
Post.intervention.2.time  1.11718 0.0606429  18.42222  0.0000

 Correlation: 
                         (Intr) Time   Intrvn Pst.n. Intr.2
Time                     -0.870                            
Intervention              0.348 -0.600                     
Post.intervention.time    0.616 -0.707 -0.017              
Intervention.2            0.000  0.000  0.250 -0.424       
Post.intervention.2.time  0.000  0.000  0.441 -0.500 -0.018

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-2.41985986 -0.75217306  0.02668579  0.65804934  2.41400886 

Residual standard error: 4.690972 
Degrees of freedom: 150 total; 144 residual</code></pre>
</div>
</div>
<p>새로운 계수는 두 번째 개입의 즉각적인 단계 변화(Intervention.2)와 두 번째 개입 이후의 추세 변화(Post.intervention.2.time)를 나타냅니다.</p>
<blockquote class="blockquote">
<p>모델 예측값 및 시각화:</p>
</blockquote>
<p>이제 구축한 모델 model.d를 사용하여 예측값을 생성하고, 이를 시각화하여 두 번의 개입이 산업재해 발생 건수에 미치는 영향을 살펴봅니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.d.predictions =</span> <span class="fu">predictSE.gls</span>(model.d, df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.d.se =</span> <span class="fu">predictSE.gls</span>(model.d, df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df3, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.d.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se), <span class="at">ymax =</span> model.d.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se)), <span class="at">fill =</span> <span class="st">"lightgreen"</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.d.predictions), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"두 번의 개입이 있는 통제되지 않은 ITS 분석"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"주차"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"주간 산업재해 발생 건수"</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>위 그래프는 실제 산업재해 발생 건수(점), 모델이 예측한 추세선(검은색 실선), 그리고 모델 예측의 95% 신뢰 구간(녹색 리본)을 보여줍니다. 그래프를 통해 두 번의 개입 시점(51주차, 101주차)에서 산업재해 발생 건수의 변화가 시각적으로 확인될 수 있습니다.</p>
<section id="반사실적-시나리오-분석-두-번의-개입" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="반사실적-시나리오-분석-두-번의-개입"><span class="header-section-number">5.4.1</span> 반사실적 시나리오 분석 (두 번의 개입):</h3>
<p>두 번의 개입이 있는 경우, 다양한 반사실적 시나리오를 고려할 수 있습니다. 예를 들어,</p>
<ul>
<li>만약 어떠한 개입도 없었다면?</li>
<li>만약 첫 번째 개입만 있었다면?</li>
</ul>
<p>각각의 반사실적 시나리오를 모델링하고 실제 결과와 비교하여 각 개입의 순수한 효과를 추정할 수 있습니다.</p>
<p>1). 첫 번째 반사실적 모델 (어떠한 개입도 없었던 경우):</p>
<p>개입 이전 데이터(50주차까지)만을 사용하여 시간 추세를 모델링하고, 전체 기간으로 외삽합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df3, Time <span class="sc">&lt;</span> <span class="dv">51</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model.e <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time, <span class="at">data =</span> df4, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.e.predictions =</span> <span class="fu">predictSE.gls</span>(model.e, <span class="at">newdata =</span> df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.e.se =</span> <span class="fu">predictSE.gls</span>(model.e, df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>두 번째 반사실적 모델 (첫 번째 개입만 있었던 경우):</li>
</ol>
<p>첫 번째 개입 이전과 이후 데이터(100주차까지)를 사용하여 첫 번째 개입의 효과를 모델링하고, 전체 기간으로 외삽합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df3, Time <span class="sc">&lt;</span> <span class="dv">101</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model.f <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention <span class="sc">+</span> Post.intervention.time,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df5, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.f.predictions =</span> <span class="fu">predictSE.gls</span>(model.f, <span class="at">newdata =</span> df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.f.se =</span> <span class="fu">predictSE.gls</span>(model.f, df3, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="사실적-모델과-반사실적-모델-비교-시각화-두-번의-개입" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="사실적-모델과-반사실적-모델-비교-시각화-두-번의-개입"><span class="header-section-number">5.4.2</span> 사실적 모델과 반사실적 모델 비교 시각화 (두 번의 개입):</h3>
<p>이제 사실적 모델(model.d)과 두 가지 반사실적 모델(model.e, model.f)의 예측값을 함께 시각화하여 각 개입의 효과를 비교합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df3, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.f.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se), <span class="at">ymax =</span> model.f.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.e.se), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.f.predictions), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># 첫 번째 개입만 있었을 경우</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.e.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se), <span class="at">ymax =</span> model.e.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.e.se), <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.e.predictions), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># 어떠한 개입도 없었을 경우</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.d.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se), <span class="at">ymax =</span> model.d.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.d.se), <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.d.predictions), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># 실제 데이터 모델</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"두 번의 개입에 대한 사실적 및 반사실적 시나리오 비교"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"주차"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"주간 산업재해 발생 건수"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"시나리오"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"시나리오"</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"사실적 시나리오"</span>, <span class="st">"첫 번째 개입만"</span>, <span class="st">"개입 없음"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"lightgreen"</span>, <span class="st">"lightblue"</span>, <span class="st">"pink"</span>)) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"사실적 시나리오"</span>, <span class="st">"첫 번째 개입만"</span>, <span class="st">"개입 없음"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>위 그래프에서 검은색 실선(녹색 리본)은 실제 데이터와 두 번의 개입을 모두 고려한 모델의 예측값입니다. 붉은색 점선(분홍색 리본)은 어떠한 개입도 없었다고 가정한 반사실적 시나리오의 예측값이며, 파란색 점선(하늘색 리본)은 첫 번째 개입만 있었다고 가정한 반사실적 시나리오의 예측값입니다.</p>
<p>각 시점에서 사실적 시나리오와 반사실적 시나리오의 차이를 통해 각 개입의 효과를 정량적으로 평가할 수 있습니다. 예를 들어, 150주차에서 사실적 시나리오 값과 첫 번째 반사실적 시나리오 값을 비교하면 두 번째 개입의 순수한 효과를 추정할 수 있습니다.</p>
</section>
<section id="개입-효과-크기-계산-두-번의-개입" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="개입-효과-크기-계산-두-번의-개입"><span class="header-section-number">5.4.3</span> 개입 효과 크기 계산 (두 번의 개입):</h3>
<p>저장된 모델 예측값을 사용하여 특정 시점에서 각 개입의 상대적인 효과를 계산할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 첫 번째 개입 직후 효과 (51주차):</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(df3<span class="sc">$</span>model.d.predictions[<span class="dv">51</span>] <span class="sc">-</span> df3<span class="sc">$</span>model.e.predictions[<span class="dv">51</span>], <span class="at">scientific =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        51 
"6.092123" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 두 번째 개입 직후 효과 (101주차):</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(df3<span class="sc">$</span>model.d.predictions[<span class="dv">101</span>] <span class="sc">-</span> df3<span class="sc">$</span>model.f.predictions[<span class="dv">101</span>], <span class="at">scientific =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        101 
"-6.791491" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 연구 종료 시점의 전체 개입 효과 (150주차):</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(df3<span class="sc">$</span>model.d.predictions[<span class="dv">150</span>] <span class="sc">-</span> df3<span class="sc">$</span>model.e.predictions[<span class="dv">150</span>], <span class="at">scientific =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       150 
"50.90872" </code></pre>
</div>
</div>
<p>결과 해석 시에는 산업보건 맥락을 고려하여 각 개입의 성격과 예상되는 효과를 바탕으로 논리적인 설명을 제시해야 합니다. 또한, 모델의 가정(예: 선형 추세, 개입 효과의 지속성 등)이 실제 데이터에 부합하는지 신중하게 평가해야 합니다.</p>
</section>
</section>
<section id="파트-3-통제된-its-단일-개입" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="파트-3-통제된-its-단일-개입"><span class="header-section-number">5.5</span> 파트 3: 통제된 ITS, 단일 개입</h2>
<p>이전까지는 통제 그룹 없이 단일 시계열 데이터만 분석하는 방법을 살펴보았습니다. 이제 통제 그룹을 포함하는 통제된 ITS 분석을 통해 개입의 효과를 보다 정확하게 평가하는 방법을 알아보겠습니다.</p>
<p>가상 데이터 생성 (통제 그룹 포함):</p>
<p>다음은 통제 그룹(quantity.y)과 개입 그룹(quantity.x)을 포함하는 가상 데이터를 생성하는 R 코드입니다</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 개입 시점: 51주차</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>df.x <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span>, <span class="co"># 개입 그룹 (x = 1)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Time =</span> x <span class="sc">*</span> Time, <span class="co"># Time 변수와 개입 그룹의 상호작용</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">50</span>)),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Intervention =</span> x <span class="sc">*</span> Intervention, <span class="co"># Intervention 변수와 개입 그룹의 상호작용</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post.intervention.time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Post.intervention.time =</span> x <span class="sc">*</span> Post.intervention.time, <span class="co"># Post.intervention.time 변수와 개입 그룹의 상호작용</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">quantity.x =</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">200</span><span class="sc">:</span><span class="dv">300</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">50</span>, <span class="at">replace =</span> T),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">170</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">40</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">50</span>, <span class="at">replace =</span> T)))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>df.y <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">0</span>, <span class="co"># 통제 그룹 (x = 0)</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Time =</span> x <span class="sc">*</span> Time,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">50</span>)),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Intervention =</span> x <span class="sc">*</span> Intervention,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post.intervention.time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.Post.intervention.time =</span> x <span class="sc">*</span> Post.intervention.time,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">quantity.x =</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">500</span><span class="sc">:</span><span class="dv">600</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">50</span>, <span class="at">replace =</span> T),</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">280</span><span class="sc">:</span><span class="dv">500</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> T), <span class="at">decreasing =</span> T) <span class="sc">+</span> <span class="fu">sample</span>(<span class="sc">-</span><span class="dv">40</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">50</span>, <span class="at">replace =</span> T)))</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df.x, df.y) <span class="sc">%&gt;%</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Time, x)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df6, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">200</span>, <span class="at">scrollY =</span> <span class="st">"200px"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-81562effa1f4d00cfc59" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-81562effa1f4d00cfc59">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200"],[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,48,49,49,50,50,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,59,59,60,60,61,61,62,62,63,63,64,64,65,65,66,66,67,67,68,68,69,69,70,70,71,71,72,72,73,73,74,74,75,75,76,76,77,77,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85,86,86,87,87,88,88,89,89,90,90,91,91,92,92,93,93,94,94,95,95,96,96,97,97,98,98,99,99,100,100],[0,1,0,2,0,3,0,4,0,5,0,6,0,7,0,8,0,9,0,10,0,11,0,12,0,13,0,14,0,15,0,16,0,17,0,18,0,19,0,20,0,21,0,22,0,23,0,24,0,25,0,26,0,27,0,28,0,29,0,30,0,31,0,32,0,33,0,34,0,35,0,36,0,37,0,38,0,39,0,40,0,41,0,42,0,43,0,44,0,45,0,46,0,47,0,48,0,49,0,50,0,51,0,52,0,53,0,54,0,55,0,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,64,0,65,0,66,0,67,0,68,0,69,0,70,0,71,0,72,0,73,0,74,0,75,0,76,0,77,0,78,0,79,0,80,0,81,0,82,0,83,0,84,0,85,0,86,0,87,0,88,0,89,0,90,0,91,0,92,0,93,0,94,0,95,0,96,0,97,0,98,0,99,0,100],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,48,49,49,50,50],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,3,0,4,0,5,0,6,0,7,0,8,0,9,0,10,0,11,0,12,0,13,0,14,0,15,0,16,0,17,0,18,0,19,0,20,0,21,0,22,0,23,0,24,0,25,0,26,0,27,0,28,0,29,0,30,0,31,0,32,0,33,0,34,0,35,0,36,0,37,0,38,0,39,0,40,0,41,0,42,0,43,0,44,0,45,0,46,0,47,0,48,0,49,0,50],[603,288,589,315,602,272,578,296,577,270,602,292,595,286,579,287,595,296,581,283,596,290,564,279,592,278,596,281,582,263,559,264,584,268,581,244,564,268,575,247,579,278,559,263,527,268,564,235,563,268,559,238,551,253,546,265,528,256,533,230,537,241,559,252,539,225,535,231,552,211,522,233,548,215,516,216,528,223,523,214,523,215,522,208,524,215,520,209,522,209,506,223,522,205,499,210,518,215,489,220,512,201,471,198,472,200,492,170,456,164,506,172,491,124,455,112,467,169,469,163,473,164,471,123,416,162,397,164,414,153,446,131,469,133,433,108,459,71,440,141,412,95,398,124,428,139,424,61,420,58,381,83,402,116,423,62,429,56,425,100,421,55,395,95,339,34,401,82,371,40,382,39,327,45,397,67,343,54,354,37,333,35,372,38,311,43,359,52,372,30,322,52,285,16,305,17,328,42,317,-3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>x<\/th>\n      <th>Time<\/th>\n      <th>x.Time<\/th>\n      <th>Intervention<\/th>\n      <th>x.Intervention<\/th>\n      <th>Post.intervention.time<\/th>\n      <th>x.Post.intervention.time<\/th>\n      <th>quantity.x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":200,"scrollY":"200px","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"x","targets":1},{"name":"Time","targets":2},{"name":"x.Time","targets":3},{"name":"Intervention","targets":4},{"name":"x.Intervention","targets":5},{"name":"Post.intervention.time","targets":6},{"name":"x.Post.intervention.time","targets":7},{"name":"quantity.x","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,25,50,100,200]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>위 코드는 다음과 같은 변수를 포함하는 데이터 프레임을 생성합니다.</p>
<ul>
<li>x: 그룹을 구분하는 변수 (0: 통제 그룹, 1: 개입 그룹).</li>
<li>Time: 연구가 진행된 주차.</li>
<li>x.Time: Time 변수와 x 변수의 상호작용 항.</li>
<li>Intervention: 개입 여부 (0: 개입 전, 1: 개입 후).</li>
<li>x.Intervention: Intervention 변수와 x 변수의 상호작용 항.</li>
<li>Post.intervention.time: 개입 후 경과 시간.</li>
<li>x.Post.intervention.time: Post.intervention.time 변수와 x 변수의 상호작용 항.</li>
<li>quantity.x: 결과 변수 (산업재해 발생 건수).</li>
</ul>
<section id="통제된-its-모델-구축" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="통제된-its-모델-구축"><span class="header-section-number">5.5.1</span> 통제된 ITS 모델 구축:</h3>
<p>통제 그룹을 포함한 ITS 모델은 다음과 같이 구축할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model.g <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> x <span class="sc">+</span> Time <span class="sc">+</span> x.Time <span class="sc">+</span> Intervention <span class="sc">+</span> x.Intervention <span class="sc">+</span> Post.intervention.time <span class="sc">+</span> x.Post.intervention.time,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df6, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">q =</span> <span class="dv">2</span>, <span class="at">form =</span> <span class="sc">~</span> Time <span class="sc">|</span> x))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: quantity.x ~ x + Time + x.Time + Intervention + x.Intervention +      Post.intervention.time + x.Post.intervention.time 
  Data: df6 
       AIC      BIC    logLik
  1740.045 1782.923 -857.0226

Correlation Structure: ARMA(2,2)
 Formula: ~Time | x 
 Parameter estimate(s):
         Phi1          Phi2        Theta1        Theta2 
-1.177446e-01  8.391505e-01 -9.056629e-06 -9.999909e-01 

Coefficients:
                             Value Std.Error   t-value p-value
(Intercept)               605.5333  2.911587 207.97365  0.0000
x                        -305.5079  4.117605 -74.19553  0.0000
Time                       -2.0115  0.107664 -18.68307  0.0000
x.Time                      0.0734  0.152260   0.48220  0.6302
Intervention               -5.7824  4.841184  -1.19442  0.2338
x.Intervention            -11.5796  6.846467  -1.69132  0.0924
Post.intervention.time     -1.5456  0.129083 -11.97404  0.0000
x.Post.intervention.time   -0.0831  0.182551  -0.45494  0.6497

 Correlation: 
                         (Intr) x      Time   x.Time Intrvn x.Intr Pst.n.
x                        -0.707                                          
Time                     -0.956  0.676                                   
x.Time                    0.676 -0.956 -0.707                            
Intervention              0.590 -0.417 -0.758  0.536                     
x.Intervention           -0.417  0.590  0.536 -0.758 -0.707              
Post.intervention.time    0.661 -0.467 -0.599  0.424 -0.013  0.009       
x.Post.intervention.time -0.467  0.661  0.424 -0.599  0.009 -0.013 -0.707

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.9007854 -0.6478441  0.1184057  0.6977688  1.9536951 

Residual standard error: 18.05594 
Degrees of freedom: 200 total; 192 residual</code></pre>
</div>
</div>
<p>corARMA 함수의 form = ~ Time | x 인수는 자기상관을 시간뿐만 아니라 그룹 간에도 고려하도록 지정합니다.</p>
<blockquote class="blockquote">
<p>모델 결과 해석:</p>
</blockquote>
<p>모델 결과의 계수는 다음과 같이 해석할 수 있습니다.</p>
<ul>
<li>(Intercept): 통제 그룹의 연구 시작 시점의 평균 결과 변수 값.</li>
<li>x: 개입 그룹과 통제 그룹 간의 연구 시작 시점의 평균 결과 변수 값 차이.</li>
<li>Time: 통제 그룹의 개입 전 시간 추세.</li>
<li>x.Time: 개입 그룹과 통제 그룹 간의 개입 전 시간 추세 차이.</li>
<li>Intervention: 통제 그룹의 개입 시점에서의 즉각적인 단계 변화.</li>
<li>x.Intervention: 개입 그룹과 통제 그룹 간의 개입 시점에서의 즉각적인 단계 변화 * 차이.</li>
<li>Post.intervention.time: 통제 그룹의 개입 이후 시간 추세 변화.</li>
<li>x.Post.intervention.time: 개입 그룹과 통제 그룹 간의 개입 이후 시간 추세 변화 차이.</li>
</ul>
</section>
<section id="대안적인-모델-구축-상호작용-항-사용" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="대안적인-모델-구축-상호작용-항-사용"><span class="header-section-number">5.5.2</span> 대안적인 모델 구축 (상호작용 항 사용):</h3>
<p>상호작용 항을 사용하여 동일한 결과를 얻을 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model.h <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">*</span> x <span class="sc">+</span> Intervention <span class="sc">*</span> x <span class="sc">+</span> Post.intervention.time <span class="sc">*</span> x,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df6, <span class="at">method =</span> <span class="st">"ML"</span>, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">q =</span> <span class="dv">2</span>, <span class="at">form =</span> <span class="sc">~</span> Time <span class="sc">|</span> x))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: quantity.x ~ Time * x + Intervention * x + Post.intervention.time *      x 
  Data: df6 
       AIC      BIC    logLik
  1740.045 1782.923 -857.0226

Correlation Structure: ARMA(2,2)
 Formula: ~Time | x 
 Parameter estimate(s):
         Phi1          Phi2        Theta1        Theta2 
-1.177446e-01  8.391505e-01 -9.017984e-06 -9.999910e-01 

Coefficients:
                             Value Std.Error   t-value p-value
(Intercept)               605.5333  2.911587 207.97365  0.0000
Time                       -2.0115  0.107664 -18.68307  0.0000
x                        -305.5079  4.117605 -74.19553  0.0000
Intervention               -5.7824  4.841184  -1.19442  0.2338
Post.intervention.time     -1.5456  0.129083 -11.97404  0.0000
Time:x                      0.0734  0.152260   0.48220  0.6302
x:Intervention            -11.5796  6.846467  -1.69132  0.0924
x:Post.intervention.time   -0.0831  0.182551  -0.45494  0.6497

 Correlation: 
                         (Intr) Time   x      Intrvn Pst.n. Time:x x:Intr
Time                     -0.956                                          
x                        -0.707  0.676                                   
Intervention              0.590 -0.758 -0.417                            
Post.intervention.time    0.661 -0.599 -0.467 -0.013                     
Time:x                    0.676 -0.707 -0.956  0.536  0.424              
x:Intervention           -0.417  0.536  0.590 -0.707  0.009 -0.758       
x:Post.intervention.time -0.467  0.424  0.661  0.009 -0.707 -0.599 -0.013

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.9007854 -0.6478441  0.1184057  0.6977688  1.9536951 

Residual standard error: 18.05594 
Degrees of freedom: 200 total; 192 residual</code></pre>
</div>
</div>
<p>model.g와 model.h는 동일한 결과를 제공하지만, 계수 해석 방식이 다릅니다.</p>
<blockquote class="blockquote">
<p>모델 예측값 및 시각화:</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> df6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.g.predictions =</span> <span class="fu">predictSE.gls</span>(model.g, df6, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.g.se =</span> <span class="fu">predictSE.gls</span>(model.g, df6, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df6, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.g.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.g.se), <span class="at">ymax =</span> model.g.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.g.se), <span class="at">fill =</span> <span class="fu">factor</span>(x), <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.g.predictions, <span class="at">color =</span> <span class="fu">factor</span>(x)), <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"통제된 ITS 분석"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"주차"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"주간 산업재해 발생 건수"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"그룹"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"그룹"</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"통제 그룹"</span>, <span class="st">"개입 그룹"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"통제 그룹"</span>, <span class="st">"개입 그룹"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="반사실적-시나리오-분석" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="반사실적-시나리오-분석"><span class="header-section-number">5.5.3</span> 반사실적 시나리오 분석:</h3>
<p>개입이 없었다면 어떤 일이 발생했을지를 추정하기 위해 반사실적 모델을 구축합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df6, Time <span class="sc">&lt;</span> <span class="dv">51</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>model.i <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> x <span class="sc">+</span> Time <span class="sc">+</span> x.Time,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df7, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">form =</span> <span class="sc">~</span> Time <span class="sc">|</span> x), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> df6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.i.predictions =</span> <span class="fu">predictSE.gls</span>(model.i, <span class="at">newdata =</span> df6, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.i.se =</span> <span class="fu">predictSE.gls</span>(model.i, df6, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>사실적 모델과 반사실적 모델 비교 시각화:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df6, <span class="fu">aes</span>(Time, quantity.x)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.g.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.g.se), <span class="at">ymax =</span> model.g.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.g.se), <span class="at">fill =</span> <span class="fu">factor</span>(x), <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.g.predictions, <span class="at">color =</span> <span class="fu">factor</span>(x)), <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, model.i.predictions, <span class="at">color =</span> <span class="fu">factor</span>(x)), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> model.i.predictions <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.i.se), <span class="at">ymax =</span> model.i.predictions <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> model.i.se), <span class="at">fill =</span> <span class="fu">factor</span>(x), <span class="at">alpha =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"통제된 ITS 분석: 사실적 vs. 반사실적 시나리오"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"주차"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"주간 산업재해 발생 건수"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"그룹"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"그룹"</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"통제 그룹"</span>, <span class="st">"개입 그룹"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"통제 그룹"</span>, <span class="st">"개입 그룹"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="InterruptedTS_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="통제-그룹의-효과-평가" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="통제-그룹의-효과-평가"><span class="header-section-number">5.5.4</span> 통제 그룹의 효과 평가:</h3>
<p>통제 그룹이 분석 결과에 미치는 영향을 평가하기 위해, 통제 그룹을 포함한 모델(model.g)과 포함하지 않은 모델(model.j)의 결과를 비교합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 통제 그룹을 포함하지 않은 모델</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>model.j <span class="ot">=</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time <span class="sc">+</span> Intervention  <span class="sc">+</span> Post.intervention.time , <span class="at">data =</span> df.x,<span class="at">method=</span><span class="st">"ML"</span>, <span class="at">correlation=</span> <span class="fu">corARMA</span>(<span class="at">p=</span><span class="dv">2</span>,<span class="at">q=</span><span class="dv">2</span>, <span class="at">form =</span> <span class="sc">~</span> Time))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>df.x <span class="ot">&lt;-</span> df.x <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.j.predictions =</span> <span class="fu">predictSE.gls</span>(model.j, <span class="at">newdata =</span> df.x, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.j.se =</span> <span class="fu">predictSE.gls</span>(model.j, df.x, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>df8 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df.x, Time <span class="sc">&lt;</span> <span class="dv">51</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>model.k <span class="ot">&lt;-</span> <span class="fu">gls</span>(quantity.x <span class="sc">~</span> Time, <span class="at">data =</span> df8, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">form =</span> <span class="sc">~</span> Time), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>df.x <span class="ot">&lt;-</span> df.x <span class="sc">%&gt;%</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.k.predictions =</span> <span class="fu">predictSE.gls</span>(model.k, <span class="at">newdata =</span> df.x, <span class="at">se.fit =</span> T)<span class="sc">$</span>fit,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">model.k.se =</span> <span class="fu">predictSE.gls</span>(model.k, df.x, <span class="at">se.fit =</span> T)<span class="sc">$</span>se</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 통제 그룹을 포함한 모델과 포함하지 않은 모델의 결과 비교</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>df6<span class="sc">$</span>model.g.predictions[<span class="dv">200</span>] <span class="sc">-</span> df6<span class="sc">$</span>model.i.predictions[<span class="dv">200</span>] <span class="co"># 통제 그룹 포함 모델</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      200 
-97.61419 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df.x<span class="sc">$</span>model.j.predictions[<span class="dv">100</span>] <span class="sc">-</span> df.x<span class="sc">$</span>model.k.predictions[<span class="dv">100</span>] <span class="co"># 통제 그룹 미포함 모델</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      100 
-95.74245 </code></pre>
</div>
</div>
<ul>
<li>통제 그룹 포함 모델의 개입 효과 추정치: 약 -60.99</li>
<li>통제 그룹 미포함 모델의 개입 효과 추정치: 약 -61.25</li>
</ul>
<p>이 코드를 통해 통제 그룹을 포함했을 때와 포함하지 않았을 때의 개입 효과 추정치를 비교하고, 통제 그룹이 분석 결과에 미치는 영향을 평가할 수 있습니다.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./timeseries_1.html" class="pagination-link" aria-label="시계열분석">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">시계열분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Jobstress.html" class="pagination-link" aria-label="job stress questionnaires">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">job stress questionnaires</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>